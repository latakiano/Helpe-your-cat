<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalayan Cat Adventure - 20 Stages</title>
    <style>
        header { 
            height: 70px; background: #1a1a1a; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; border-bottom: 2px solid #444;
        }
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; touch-action: none; }
        #ui-text { color: white; font-size: 18px; margin-bottom: 5px; font-weight: bold; }
        .progress-container { width: 80%; height: 10px; background: #333; border-radius: 10px; overflow: hidden; border: 1px solid #555; }
        #fill { width: 0%; height: 100%; background: linear-gradient(90deg, #f1c40f, #2ecc71); transition: width 0.2s; }
        #ov { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; z-index: 1000; text-align: center; }
        button { padding: 15px 50px; font-size: 24px; cursor: pointer; background: #27ae60; color: white; border: none; border-radius: 50px; font-weight: bold; box-shadow: 0 4px 0 #1e8449; }
        button:active { transform: translateY(2px); box-shadow: none; }
    </style>
</head>
<body>

<header>
    <div id="ui-text">ğŸ¾ Ø§Ù„Ù…Ø±Ø­Ù„Ø© <span id="lvlNum">1</span>: <span id="lvlName">ØºØ§Ø¨Ø© Ø§Ù„Ø°Ø¦Ø§Ø¨</span> | ğŸŸ <span id="sc">0</span></div>
    <div class="progress-container"><div id="fill"></div></div>
</header>

<div id="ov">
    <h1 id="msg">Ù…ØºØ§Ù…Ø±Ø© Ù‚Ø·Ø© Ø§Ù„Ù‡Ù…Ù„Ø§ÙŠØ§ ğŸˆ</h1>
    <p>Ø³Ø§Ø¹Ø¯ÙŠ Ø§Ù„Ù‚Ø·Ø© Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒÙˆØ® Ø¨Ø³Ù„Ø§Ù…!</p>
    <button onclick="startStage()">Ø¥Ø¨Ø¯Ø£ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø© ğŸš€</button>
</div>

<canvas id="c"></canvas>

<script>
    const cvs = document.getElementById('c'), ctx = cvs.getContext('2d');
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function resize() { cvs.width = window.innerWidth; cvs.height = window.innerHeight - 70; }
    window.onresize = resize; resize();

    // Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØ±
    const I = {
        cat: 'https://img.icons8.com/color/96/cat--v1.png',
        wolf: 'https://img.icons8.com/color/150/wolf.png',
        ghost: 'https://img.icons8.com/color/150/ghost.png',
        eagle: 'https://img.icons8.com/color/150/eagle.png',
        snake: 'https://img.icons8.com/color/150/snake.png',
        croc: 'https://img.icons8.com/color/150/crocodile.png',
        lion: 'https://img.icons8.com/color/150/lion.png',
        dragon: 'https://img.icons8.com/color/150/dragon.png',
        bear: 'https://img.icons8.com/color/150/polar-bear.png',
        alien: 'https://img.icons8.com/color/150/alien.png',
        monster: 'https://img.icons8.com/color/150/monster-face.png',
        cabin: 'https://img.icons8.com/color/200/log-cabin.png'
    };

    const imgs = {};
    Object.keys(I).forEach(k => { imgs[k] = new Image(); imgs[k].src = I[k]; });

    const stages = [
        {n:"ØºØ§Ø¨Ø© Ø§Ù„Ø°Ø¦Ø§Ø¨", m:"wolf", bg:"#1b3022", obs:"#ffeb3b", s:6},
        {n:"Ù…Ù‚Ø¨Ø±Ø© Ø§Ù„Ø£Ø´Ø¨Ø§Ø­", m:"ghost", bg:"#2e003e", obs:"#00ff00", s:7},
        {n:"Ø¬Ø¨Ø§Ù„ Ø§Ù„Ù†Ø³ÙˆØ±", m:"eagle", bg:"#002244", obs:"#ff4081", s:8},
        {n:"ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø£ÙØ§Ø¹ÙŠ", m:"snake", bg:"#2d1b00", obs:"#76ff03", s:9},
        {n:"Ù†Ù‡Ø± Ø§Ù„ØªÙ…Ø§Ø³ÙŠØ­", m:"croc", bg:"#004d40", obs:"#ff9100", s:10},
        {n:"Ø¹Ø±ÙŠÙ† Ø§Ù„Ø£Ø³Ø¯", m:"lion", bg:"#3e2723", obs:"#ffff00", s:10.5},
        {n:"ÙƒÙ‡Ù Ø§Ù„ØªÙ†ÙŠÙ†", m:"dragon", bg:"#210000", obs:"#00e5ff", s:11},
        {n:"Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¬Ù„ÙŠØ¯", m:"bear", bg:"#e1f5fe", obs:"#3f51b5", s:11.5},
        {n:"Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ù…Ø¸Ù„Ù…", m:"alien", bg:"#0a0a2a", obs:"#eeff41", s:12},
        {n:"Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø©", m:"monster", bg:"#1a1a1a", obs:"#ff1744", s:13},
        // ÙƒØ±Ø±Ù†Ø§ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø£Ùˆ Ø²Ø¯Ù†Ø§ Ø§Ù„Ø³Ø±Ø¹Ø© Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù€ 20
        {n:"Ø¹ÙˆØ¯Ø© Ø§Ù„Ø°Ø¦Ø¨", m:"wolf", bg:"#000", obs:"#fff", s:14},
        {n:"Ø´Ø¨Ø­ Ø§Ù„Ù„ÙŠÙ„", m:"ghost", bg:"#1a0033", obs:"#0f0", s:15},
        {n:"Ù†Ø³Ø± Ø§Ù„Ù‚Ù…Ø©", m:"eagle", bg:"#001a33", obs:"#f0f", s:16},
        {n:"Ø£ÙØ¹Ù‰ Ø§Ù„ØµØ­Ø±Ø§Ø¡", m:"snake", bg:"#1a1a00", obs:"#0ff", s:17},
        {n:"ØªÙ…Ø³Ø§Ø­ Ø§Ù„Ù†ÙŠÙ„", m:"croc", bg:"#001a1a", obs:"#ff0", s:18},
        {n:"ØºØ¶Ø¨ Ø§Ù„Ø£Ø³Ø¯", m:"lion", bg:"#1a0a00", obs:"#f00", s:19},
        {n:"Ù„Ù‡ÙŠØ¨ Ø§Ù„ØªÙ†ÙŠÙ†", m:"dragon", bg:"#1a0000", obs:"#fff", s:20},
        {n:"Ø¬Ù„ÙŠØ¯ Ø§Ù„Ù…ÙˆØª", m:"bear", bg:"#fff", obs:"#00f", s:21},
        {n:"ØºØ²Ùˆ Ø§Ù„ÙØ¶Ø§Ø¡", m:"alien", bg:"#000", obs:"#0f0", s:22},
        {n:"Ø§Ù„Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©", m:"monster", bg:"#ff0000", obs:"#000", s:24}
    ];

    let cur = 0, dist = 1000, active = false, started = false, score = 0;
    let p = { x: 100, y: 0, v: 0 }, m = { x: -150, y: 0 }, obs = [], fish = [], cabinX = -500;
    let lastObsTime = 0;

    function playTone(freq, type, dur) {
        try {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type; osc.frequency.value = freq;
            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + dur);
        } catch(e){}
    }

    function startStage() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        document.getElementById('ov').style.display = 'none';
        dist = 1000; p.y = cvs.height/2; p.v = 0; m.x = -150;
        obs = []; fish = []; cabinX = -500; active = true; started = false;
        document.getElementById('lvlNum').innerText = (cur+1);
        document.getElementById('lvlName').innerText = stages[cur].n;
    }

    function die() {
        playTone(150, 'sawtooth', 0.5);
        active = false; document.getElementById('ov').style.display = 'flex';
        document.getElementById('msg').innerText = "Ø£Ù…Ø³Ùƒ Ø¨Ùƒ " + stages[cur].n;
    }

    function loop() {
        let s = stages[cur];
        ctx.fillStyle = s.bg; ctx.fillRect(0, 0, cvs.width, cvs.height);

        if (active && started) {
            p.v += 0.45; p.y += p.v; dist -= s.s / 12;
            m.y += (p.y - m.y) * 0.05; m.x = Math.min(p.x - 130, m.x + 0.3);

            if (dist <= 0) {
                if(cabinX === -500) { cabinX = cvs.width; playTone(600, 'sine', 0.2); }
                cabinX -= s.s;
                if(p.x > cabinX + 60) {
                    active = false; cur++;
                    if(cur >= 20) { cur = 0; document.getElementById('msg').innerText = "ğŸ† Ù…Ù„ÙƒØ© Ø§Ù„Ù‡Ù…Ù„Ø§ÙŠØ§! Ø®ØªÙ…ØªÙ Ø§Ù„Ù„Ø¹Ø¨Ø©!"; }
                    else { document.getElementById('msg').innerText = "ğŸ¡ ÙˆØµÙ„ØªÙ Ù„Ù„ÙƒÙˆØ® Ø¨Ø³Ù„Ø§Ù…!"; }
                    document.getElementById('ov').style.display = 'flex';
                }
            }

            let now = Date.now();
            if (dist > 50 && now - lastObsTime > 1600) {
                let gap = 260, g = Math.random() * (cvs.height - 400) + 80;
                obs.push({ x: cvs.width, y: g, h: gap });
                fish.push({ x: cvs.width + 100, y: g + gap/2 });
                lastObsTime = now;
            }

            obs.forEach((o, i) => {
                o.x -= s.s;
                ctx.fillStyle = s.obs; ctx.fillRect(o.x, 0, 50, o.y); ctx.fillRect(o.x, o.y+o.h, 50, cvs.height);
                if (p.x+40 > o.x && p.x+5 < o.x+50 && (p.y < o.y || p.y+40 > o.y+o.h)) die();
                if (o.x < -100) obs.splice(i, 1);
            });

            fish.forEach((f, i) => {
                f.x -= s.s; ctx.font = "30px Arial"; ctx.fillText("ğŸ ", f.x, f.y);
                if (Math.hypot(p.x-f.x, p.y-f.y) < 45) { score += 100; fish.splice(i, 1); playTone(1200, 'sine', 0.1); }
            });

            if (p.y > cvs.height || p.y < -50 || p.x < m.x + 60) die();
            document.getElementById('fill').style.width = (1 - dist/1000)*100 + "%";
            document.getElementById('sc').innerText = score;
        }

        // Ø±Ø³Ù… Ø§Ù„ÙƒÙˆØ®
        if(cabinX > -500) {
            if(imgs.cabin.complete) ctx.drawImage(imgs.cabin, cabinX, cvs.height/2-80, 160, 160);
        }

        // Ø±Ø³Ù… Ø§Ù„ÙˆØ­Ø´ (Ø¹ÙƒØ³ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ù„ÙŠÙ…Ø´ÙŠ Ù„Ù„ÙŠÙ…ÙŠÙ†)
        const eImg = imgs[s.m];
        if(eImg && eImg.complete) {
            ctx.save(); ctx.translate(m.x + 100, m.y); ctx.scale(-1, 1);
            ctx.drawImage(eImg, 0, 0, 100, 100); ctx.restore();
        }

        // Ø±Ø³Ù… Ø§Ù„Ù‚Ø·Ø©
        if(imgs.cat.complete) ctx.drawImage(imgs.cat, p.x, p.y, 60, 60);

        requestAnimationFrame(loop);
    }

    const jump = () => { if(active) { started = true; p.v = -8; playTone(400, 'square', 0.05); } }
    window.onmousedown = jump;
    window.ontouchstart = (e) => { if(active) { e.preventDefault(); jump(); } };
    loop();
</script>
</body>
</html>